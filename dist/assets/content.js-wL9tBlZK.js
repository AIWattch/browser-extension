import{s as l,g as u}from"./storage-DDbOanX3.js";const p=new MutationObserver((t,c)=>{for(const s of t)s.type==="childList"&&s.addedNodes.forEach(n=>{if(typeof n.className=="string"&&n.className==="fixed right-4 top-8 my-2 flex max-h-[90vh] flex-col-reverse space-y-2 space-y-reverse overflow-y-auto px-2 py-4"){const e=n.innerText.replace("ChatGPT",""),o=document.querySelectorAll("article"),i=o[o.length-2],r=[];r.push({type:"inputTokens",content:i.innerText}),r.push({type:"outputTokens",content:e}),h(r)}})});p.observe(document.body,{childList:!0,subtree:!0});function h(t){console.log("ChatGPT output finished");const c=[];t.forEach(s=>{const n=g(s);c.push(n)}),Promise.all(c).then(s=>{let n={};s.forEach(e=>{let o=Object.keys(e)[0],i=Object.values(e)[0];n[o]=i}),d(n).then(e=>e).then(e=>(l({user:e}),e)).then(e=>{f(e)})}).catch(s=>{console.error(s)})}const g=function(t){return new Promise(function(c,s){t.content;const n=t.content.length,e=t.type;u("config").then(o=>{const i=n/o.charsPerToken;u("user").then(r=>{const a=r[e],m=Math.ceil(a+i);c({[e]:m})})})})},d=function(t){return new Promise(function(c,s){const n=t.inputTokens,e=t.outputTokens;u("config").then(o=>(n*o.inputFactor+e*o.outputFactor)*o.PUE*o.gridFactor).then(o=>{t.totalEmissions=o,c(t)})})},y=function(){return new Promise(function(t,c){const s="user-stats",n=document.querySelector(`#${s}`);if(n){const e=n.querySelector("span");t([n,e])}else{const e=document.createElement("div"),o=document.createElement("span");e.id=s,e.insertAdjacentElement("afterbegin",o),document.body.insertAdjacentElement("afterbegin",e),t([e,o])}})};function f(t){window.location.href.startsWith("chrome-extension://")||y().then(c=>{const s=c[0],n=c[1];if(u("ui").then(o=>{s.style.top=o.yPos,s.style.left=o.xPos}),k(s),n.textContent=`Input tokens: ${t.inputTokens} \r
`,n.textContent+=`Output tokens: ${t.outputTokens} \r
`,n.textContent+=`Total emissions: ${t.totalEmissions.toString().substring(0,6)}gCO2e \r
`,!document.querySelector(".reset-btn")){const o=document.createElement("img");o.className="reset-btn",o.src=chrome.runtime.getURL("../assets/reset.svg"),o.addEventListener("mouseup",function(i){const r={};r.user={},r.user.inputTokens=0,r.user.outputTokens=0,r.user.totalEmissions=0,l(r).then(a=>{console.log("cleared storage OK"),f(r.user)}).catch(a=>{console.log(a)})},!0),s.appendChild(o)}})}const T=function(){return new Promise(function(t,c){const s=[];["ui","config","user","system"].forEach(e=>{s.push=E(e)}),Promise.all(s).then(e=>{t(e)}).catch(e=>{console.error(e)})})},E=function(t){return new Promise(function(c,s){u(t).then(n=>{console.log(`${t} values loaded OK`),console.log(n),t==="user"&&f(n)}).catch(n=>{if(n==="emptyKey"){console.log(`No ${t} values found`);const e={};t==="user"?(e.user={},e.user.inputTokens=0,e.user.outputTokens=0,e.user.totalEmissions=0):t==="config"?(e.config={},e.config.charsPerToken=4,e.config.gridFactor=383,e.config.inputFactor=.014,e.config.outputFactor=.07,e.config.PUE=1.125):t==="ui"?(e.ui={},e.ui.xPos="68%",e.ui.yPos="70%"):t==="system"&&(e.system={},e.system.chromeVersion=x()),l(e).then(o=>{console.log(`${t} values saved OK`),c(o)})}else console.error(n)})})};T();function k(t){let c,s=[0,0],n=!1;t.addEventListener("mousedown",function(e){n=!0,s=[t.offsetLeft-e.clientX,t.offsetTop-e.clientY]},!0),document.addEventListener("mouseup",function(){n=!1;const e={};e.ui={},e.ui.xPos=t.style.left,e.ui.yPos=t.style.top,l(e).then(o=>{console.log("ui position updated OK")})},!0),document.addEventListener("mousemove",function(e){e.preventDefault(),n&&(c={x:e.clientX,y:e.clientY},t.style.left=c.x+s[0]+"px",t.style.top=c.y+s[1]+"px")},!0)}function x(){var t=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return t?parseInt(t[2],10):!1}export{T as doInitConfig};
