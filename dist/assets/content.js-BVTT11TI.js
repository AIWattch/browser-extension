import{s as a,g as r}from"./storage-D14jfMDo.js";const d=new MutationObserver((n,s)=>{for(const i of n)i.type==="childList"&&i.addedNodes.forEach(o=>{typeof o.className=="string"&&o.className==="mt-3 w-full empty:hidden"&&h()})});d.observe(document.body,{childList:!0,subtree:!0});function h(){console.log("ChatGPT output finished"),setTimeout(()=>{let n=document.querySelectorAll("article"),s=n[n.length-2],i=n[n.length-1],o=[s,i];const e=[];o.forEach(t=>{const c=y(t);e.push(c)}),Promise.all(e).then(t=>{let c={};t.forEach(u=>{let l=Object.keys(u)[0],f=Object.values(u)[0];c[l]=f}),T(c).then(u=>u).then(u=>(a({user:u}),u)).then(u=>{g(u)})}).catch(t=>{console.error(t)})},1e3)}const y=function(n){return new Promise(function(s,i){let o=n.querySelector(".text-message");o.textContent;let e=o.textContent.length,t=o.getAttribute("data-message-author-role");t==="user"&&(t="inputTokens"),t==="assistant"&&(t="outputTokens"),r("config").then(c=>{const u=e/c.charsPerToken;r("user").then(l=>{const m=l[t]+u;s({[t]:m})})})})},T=function(n){return new Promise(function(s,i){const o=n.inputTokens,e=n.outputTokens;r("config").then(t=>(o*t.inputFactor+e*t.outputFactor)*t.PUE*t.gridFactor).then(t=>{n.totalEmissions=t,s(n)})})};function g(n){let s;const i="user-stats",o=document.querySelector(`#${i}`);if(o)s=o.querySelector("span"),r("ui").then(e=>{o.style.top=e.yPos,o.style.left=e.xPos}),p(o);else{const e=document.createElement("div");e.id=i,s=document.createElement("span"),r("ui").then(t=>{e.style.top=t.yPos,e.style.left=t.xPos}),p(e),e.insertAdjacentElement("afterbegin",s),document.body.insertAdjacentElement("afterbegin",e)}s.textContent=`Input tokens: ${n.inputTokens} \r
`,s.textContent+=`Output tokens: ${n.outputTokens} \r
`,s.textContent+=`Total emissions: ${n.totalEmissions.toString().substring(0,6)}gCO2e/kWh \r
`}const k=function(){return new Promise(function(n,s){["ui","config","user"].forEach(o=>{r(o).then(e=>{console.log(`${o} values loaded OK`),console.log(e),o==="user"&&g(e)}).catch(e=>{if(e==="emptyKey"){console.log(`No ${o} values found`);const t={};o==="user"?(t.user={},t.user.inputTokens=0,t.user.outputTokens=0,t.user.totalEmissions=0):o==="config"?(t.config={},t.config.charsPerToken=4,t.config.gridFactor=383,t.config.inputFactor=1e-7,t.config.outputFactor=2e-7,t.config.PUE=1.125):o==="ui"&&(t.ui={},t.ui.xPos="0px",t.ui.yPos="80%"),a(t).then(c=>{console.log(`${o} values saved OK`)})}else console.error(e)})})})};k();function p(n){let s,i=[0,0],o=!1;n.addEventListener("mousedown",function(e){o=!0,i=[n.offsetLeft-e.clientX,n.offsetTop-e.clientY]},!0),document.addEventListener("mouseup",function(){o=!1;const e={};e.ui={},e.ui.xPos=n.style.left,e.ui.yPos=n.style.top,a(e).then(t=>{console.log("ui position updated OK")})},!0),document.addEventListener("mousemove",function(e){e.preventDefault(),o&&(s={x:e.clientX,y:e.clientY},n.style.left=s.x+i[0]+"px",n.style.top=s.y+i[1]+"px")},!0)}
